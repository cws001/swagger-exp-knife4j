# âœˆï¸ ä¸€ã€å·¥å…·æ¦‚è¿°

springboot-exp-knif4j ä¸»è¦ç”¨äºŽSwaggeræŽ¥å£åˆ†æž ï¼Œæ‰¹é‡æµ‹è¯•æŽ¥å£æ˜¯å¦å­˜åœ¨æœªæŽˆæƒã€‚

æ—¥å¸¸æ¸—é€è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°Spring Bootæ­å»ºçš„å¾®æœåŠ¡ï¼Œå½“å‘çŽ°æŽ¥å£æ–‡æ¡£æ³„éœ²æ—¶ï¼Œæ‰‹å·¥æµ‹è¯•APIæŽ¥å£æœªæŽˆæƒå·¥ä½œé‡è¾ƒå¤§ï¼ŒäºŽæ˜¯å‚è€ƒäº†å·¥å…· [springboot-exp]:https://github.com/lijiejie/swagger-exp çš„åŽŸç†ï¼Œå¼€å‘äº†ä¸€æ¬¾åŸº äºŽKnife4j çš„ Swagger æŽ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•æœªæŽˆæƒå·¥å…·ï¼Œè¾ƒå…¶ä»–è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·è€Œè¨€ï¼Œæœ¬å·¥å…·å¢žåŠ äº†å‚æ•°æ”¯æŒï¼Œä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒï¼Œæ”¹è¿›äº†Swaggeræµ‹è¯•ç•Œé¢ï¼Œå¹¶ä¸”æ”¯æŒè‡ªå®šä¹‰è®¾ç½®å…¨å±€è¯·æ±‚å¤´å‚æ•°ã€‚

**å½“å‰å·¥å…·ç‰ˆæœ¬å·ï¼šV1.1--2024/05/01**

# ðŸ“ äºŒã€åŠŸèƒ½æ”¯æŒ

- [ ] æ”¯æŒæœ¬åœ°å¼€å¯HTTPæœåŠ¡æ‰“å¼€Chromeï¼Œä¾›åˆ†æžæŽ¥å£ä½¿ç”¨ã€‚

	- æŽ¥å£æµ‹è¯•é¡µé¢ä¸º `Knife4j`é¡µé¢ï¼Œæ”¯æŒè‡ªå®šä¹‰è®¾ç½®å…¨å±€è¯·æ±‚å¤´å‚æ•°ã€‚ï¼ˆé›† Swagger2 å’Œ OpenAPI3 ä¸ºä¸€ä½“ï¼Œå…¼å®¹ OpenAPI 2.0ã€3.0ï¼‰

	- æ”¯æŒè‡ªåŠ¨èŽ·å– `api-json` çš„ API é›†ä¿å­˜åˆ°æœ¬åœ° Knife4j é¡µé¢è¿›è¡Œæµ‹è¯•

	- æ”¯æŒå•ç‹¬å°† `api-json` çš„ API é›†æ”¾åˆ°æœ¬åœ° Knif4j é¡µé¢è¿›è¡Œæµ‹è¯•

- [ ] æ”¯æŒè‡ªåŠ¨æµ‹è¯•æŽ¥å£æ˜¯å¦å­˜åœ¨æœªæŽˆæƒçš„å¯èƒ½ã€‚

	- æ”¯æŒè‡ªåŠ¨åŒ– GET / POST è¯·æ±‚ api-doc çš„æ‰€æœ‰æŽ¥å£ï¼Œè¿”å›ž Response Code / Content-Type / Content-Length

	- æ”¯æŒè‡ªåŠ¨å¡«å……å‚æ•°å€¼åŽ»éåŽ†æ‰€æœ‰APIæŽ¥å£ï¼Œç”¨äºŽåˆ†æžæŽ¥å£æ˜¯å¦å¯ä»¥æœªæŽˆæƒè®¿é—®åˆ©ç”¨

- [ ] æ”¯æŒè‡ªåŠ¨åŒ–åˆ†æžæŽ¥å£æ˜¯å¦å­˜åœ¨æ•æ„Ÿå‚æ•°ã€‚

	- åˆ†æžæŽ¥å£æ˜¯å¦å­˜åœ¨æ•æ„Ÿå‚æ•°ï¼Œä¾‹å¦‚urlå‚æ•°ï¼Œå®¹æ˜“å¼•å…¥å¤–ç½‘çš„SSRFæ¼æ´ž

- [ ] æ£€æµ‹ APIè®¤è¯ç»•è¿‡æ¼æ´ž

	- å½“å­˜åœ¨HTTPè®¤è¯ç»•è¿‡æ¼æ´žæ—¶ï¼Œæœ¬åœ°æœåŠ¡å™¨æ‹¦æˆªAPIæ–‡æ¡£ï¼Œä¿®æ”¹pathï¼Œä»¥ä¾¿ç›´æŽ¥åœ¨Swagger UIä¸­è¿›è¡Œæµ‹è¯•

- [ ] æ”¯æŒæ‰«æç»“æžœç”Ÿæˆ

	- `result_ApiScanSummary.txt`	æŽ¥å£æµ‹è¯•ç»“æžœæ±‡æ€»ï¼ˆæ˜¯ä¸€ç›´ç´¯åŠ çš„ï¼‰
- `result_RequestDeny.txt`	è‡ªåŠ¨åŒ–æµ‹è¯•æ—¶ï¼Œè¯·æ±‚è¢«æ‹’ç»çš„æŽ¥å£
	- `result_sensitive.txt`	å­˜åœ¨æ•æ„Ÿå‚æ•°çš„æŽ¥å£
- `result_UnAuthorized.txt`	å¯èƒ½å­˜åœ¨æœªæŽˆæƒçš„æŽ¥å£

# ðŸ›¸ ä¸‰ã€ å·¥å…·ç•Œé¢ï¼š

## 0x01 æŽ§åˆ¶å°è¾“å‡ºç•Œé¢

è‡ªåŠ¨åŒ– GET / POST è¯·æ±‚ï¼Œç–‘ä¼¼æœªæŽˆæƒçš„æŽ¥å£ä¼šæ ‡çº¢æ˜¾ç¤ºï¼Œå­˜åœ¨æ•æ„Ÿå‚æ•°çš„æŽ¥å£ä¼šæ ‡ç»¿æ˜¾ç¤ºï¼Œæ‰«æå®Œæˆç»“æžœåˆ†ç±»è¾“å‡ºåˆ°æ–‡æœ¬ã€‚

![image-20240428025116659](/image/image-20240428025116659.png)

æ‰«æå®Œæˆæœ¬åœ°è‡ªåŠ¨å¼€å¯ HTTP æœåŠ¡è¿›è¡Œç›‘å¬ï¼Œå¹¶æ‰“å¼€ç¦ç”¨ CORS çš„ Chromeï¼Œæ‰“å¼€ Knife4j ç•Œé¢ï¼Œæ–¹ä¾¿æ‰‹å·¥åˆ†æžæŽ¥å£

![image-20240428030229189](/image/image-20240428030229189.png)

##  0x02 Knife4j ç•Œé¢

Knife4j ç•Œé¢åŠŸèƒ½çš„ä½¿ç”¨å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://doc.xiaominfo.com

**æ³¨æ„ï¼šï¼ˆ Knife4j ç•Œé¢é‡Œä¸€å®šè¦åœ¨`ä¸ªæ€§åŒ–è®¾ç½®`æ‰‹åŠ¨å‹¾é€‰ HOSTï¼Œå†åˆ·æ–°é¡µé¢ï¼Œæ‰èƒ½è¿›è¡Œæ­£å¸¸æ‰‹å·¥åœ¨é¡µé¢è¿›è¡Œæµ‹è¯•ï¼‰**

![image-20240428031931404](/image/image-20240428031931404.png)

1ã€æ”¯æŒè‡ªå®šä¹‰è®¾ç½®å…¨å±€è¯·æ±‚å¤´å‚æ•°ã€‚

![image-20240428032119132](/image/image-20240428032119132.png)

2ã€è‡ªåŠ¨åˆ—å‡ºæ‰€æœ‰åˆ†ç»„ä¸‹æŽ¥å£æ•°é‡ï¼ŒæŽ¥å£æ–‡æ¡£ç•Œé¢å¯æ›´ç›´è§‚åœ°é¢„è§ˆæŽ¥å£å‚æ•°æè¿°

![image-20240427225134294](/image/image-20240427225134294.png)

3ã€å¯ç›´æŽ¥åœ¨ Knife4j ç•Œé¢å‘èµ·è¯·æ±‚ï¼Œè°ƒè¯•æŽ¥å£ã€‚ç›¸æ¯”äºŽåŽŸç”ŸSwagger-uiç•Œé¢æ›´ç¬¦åˆç”¨æˆ·ä½¿ç”¨ä¹ æƒ¯ã€‚

![image-20240427225223789](/image/image-20240427225223789.png)

# ðŸš¨ å››ã€å·¥å…·ä½¿ç”¨æ³¨æ„

- [ ] ä¸€å®šè¦åœ¨`ä¸ªæ€§åŒ–è®¾ç½®`æ‰‹åŠ¨å‹¾é€‰ HOSTï¼Œå†åˆ·æ–°é¡µé¢
- [ ] éƒ¨åˆ† HTTPS ç½‘ç«™æµ‹è¯•æ—¶æŠ¥é”™` Network Error`ï¼Œå¯åœ¨`ä¸ªæ€§åŒ–è®¾ç½®` HOST å¤„åŠ ä¸Šåè®®å·ï¼Œå¦‚ https://example.com
- [ ] å¦‚æžœåœ¨æŽ§åˆ¶å° `Ctrl+C` å¡ä½ï¼Œå…³é—­ chrome æµè§ˆå™¨åˆ™å¯ä»¥ç»“æŸæœ¬åœ° HTTP æœåŠ¡
- [ ]  -u æŒ‡å®š URL æ—¶ï¼Œè·¯å¾„æœ«å°¾ä¸è¦å¸¦å¤šä½™çš„ç¬¦å·ï¼ˆå¦‚ #/ï¼‰

![image-20240428031931404](/image/image-20240428031931404.png)



# ðŸ‰ äº”ã€å·¥å…·ä½¿ç”¨

**æ³¨æ„ï¼šï¼ˆ Knife4j ç•Œé¢é‡Œä¸€å®šè¦åœ¨`ä¸ªæ€§åŒ–è®¾ç½®`æ‰‹åŠ¨å‹¾é€‰ HOSTï¼Œå†åˆ·æ–°é¡µé¢ï¼Œæ‰èƒ½è¿›è¡Œæ­£å¸¸æµ‹è¯•ï¼‰**

### 1ã€æœ¬å·¥å…·çš„å‚æ•°å¦‚ä¸‹ï¼š

```
âžœ python swagger-exp-knife4j.py

  ____                                     _____
/ ___|_      ____ _  __ _  __ _  ___ _ __| ____|_  ___ __
\___ \ \ /\ / / _` |/ _` |/ _` |/ _ \ '__|  _| \ \/ / '_ \
 ___) \ V  V / (_| | (_| | (_| |  __/ |  | |___ >  <| |_) |
|____/ \_/\_/ \__,_|\__, |\__, |\___|_|  |_____/_/\_\ .__/
                    |___/ |___/                     |_|

 _  __      _  __      _  _   _     +-------+
| |/ /_ __ (_)/ _| ___| || | (_)    + v1.1  +
| ' /| '_ \| | |_ / _ \ || |_| |    +-------+
| . \| | | | |  _|  __/__   _| |
|_|\_\_| |_|_|_|  \___|  |_|_/ |
                           |__/


å‚æ•°ï¼š
    -u  --url       æŒ‡å®š Swagger ç›¸å…³URL
    -c  --chrome    æœ¬åœ°æ‰“å¼€chromeç¦ç”¨CORSï¼Œæ‰“å¼€ Knife4j ç•Œé¢

ç”¨æ³•:
    åªæ‰“å¼€Knife4j è¿›è¡Œåˆ†æžï¼š             python3 swagger-exp-knife4j.py -c
    æ‰«ææ‰€æœ‰APIé›†ï¼Œåˆ†æžæŽ¥å£æ˜¯å¦å­˜åœ¨æœªæŽˆæƒï¼š  python3 swagger-exp-knife4j.py -u http://example.com/swagger-resources
    æ‰«æä¸€ä¸ªAPIé›†ï¼Œåˆ†æžæŽ¥å£æ˜¯å¦å­˜åœ¨æœªæŽˆæƒï¼š  python3 swagger-exp-knife4j.py -u http://example.com/v2/api-docs
    æ‰«æä¸€ä¸ªAPIé›†ï¼Œçˆ¬å–api-docæ‰“å¼€Chromeï¼špython3 swagger-exp-knife4j.py -u http://example.com/swagger-ui.html

æ³¨æ„ï¼š
    1ã€Knife4j ç•Œé¢é‡Œä¸€å®šè¦åœ¨ 'ä¸ªæ€§åŒ–è®¾ç½®' æ‰‹åŠ¨å‹¾é€‰ HOST åˆ·æ–°é¡µé¢,æ‰èƒ½è¿›è¡Œæ­£å¸¸æµ‹è¯•ã€‚
    2ã€éƒ¨åˆ† HTTPS ç½‘ç«™æµ‹è¯•æ—¶æŠ¥é”™Network Errorï¼Œå¯åœ¨ä¸ªæ€§åŒ–è®¾ç½® HOST å¤„åŠ ä¸Šåè®®å·ï¼Œå¦‚ https://example.com

```





### 2ã€æ‰«æ swagger-ui.html

æ‰«æä¸€ä¸ªAPIé›†ï¼Œçˆ¬å–ç›®æ ‡ `api-doc `å†…å®¹ï¼Œä¿å­˜åˆ°æœ¬åœ°å­˜ä¸º `api-docs.json`ï¼Œæ‰“å¼€ Knife4j ç•Œé¢

```
python3 swagger-exp-knife4j.py -u http://example.com/swagger-ui.html
```

![image-20240428031331211](/image/image-20240428031331211.png)

### 2ã€åªæ‰“å¼€ Chrome ç”Ÿæˆé¡µé¢ï¼Œä¸åšä»»ä½•æ‰«æ

åªæ‰“å¼€ç¦ç”¨ CORS çš„ chromeï¼Œ æŠŠæœ¬åœ° `api-docs.json` æ–‡ä»¶æ¸²æŸ“åˆ° Knife4j ç•Œé¢è¿›è¡Œæµ‹è¯•ã€‚ï¼ˆæ‰€ä»¥å½“ç½‘ç«™æŽ¥å£å†…å®¹æ— æ³•çˆ¬å–åˆ°æ—¶ï¼Œå¯ä»¥æ‰‹åŠ¨æŠŠç½‘ç«™ /api-docs è¦†ç›–æŽ‰`api-docs.json`ï¼Œç„¶åŽ ` -c` æ‰“å¼€ Chromeï¼‰

```
python3 swagger-exp-knife4j.py -c
```

![image-20240427221626545](/image/image-20240427221626545.png)

### 4ã€æ‰«æ /api-docs

æ‰«æä¸€ä¸ªAPIé›†ï¼Œåˆ†æžæŽ¥å£æ˜¯å¦å­˜åœ¨æœªæŽˆæƒï¼Œç–‘ä¼¼å­˜åœ¨æœªæŽˆæƒçš„æŽ¥å£ä¿å­˜åœ¨ `result_UnAuthorized.txt`ï¼Œæ‰“å¼€ Knife4j ç•Œé¢

```
python3 swagger-exp-knife4j.py -u http://example.com/v2/api-docs
```

### 3ã€æ‰«æ /swagger-resources

æ‰«ææ‰€æœ‰APIé›†ï¼Œå¹¶åˆ†æžæŽ¥å£æ˜¯å¦å­˜åœ¨æœªæŽˆæƒï¼Œç–‘ä¼¼å­˜åœ¨æœªæŽˆæƒçš„æŽ¥å£ä¿å­˜åœ¨ `result_UnAuthorized.txt`ï¼Œæ‰“å¼€ Knife4j ç•Œé¢

```
python3 swagger-exp-knife4j.py -u http://example.com/swagger-resources
```

# ðŸ– å…­ã€å…è´£å£°æ˜Ž



å¦‚æžœæ‚¨ä¸‹è½½ä½¿ç”¨å³è¡¨æ˜Žæ‚¨ä¿¡ä»»æœ¬å·¥å…·ï¼Œåœ¨ä½¿ç”¨æ—¶é€ æˆçš„æŸå¤±å’Œä¼¤å®³ï¼Œæˆ‘ä»¬ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚ä½¿ç”¨æœ¬å·¥å…·çš„è¿‡ç¨‹ä¸­å­˜åœ¨ä»»ä½•éžæ³•è¡Œä¸ºéœ€è‡ªè¡Œæ‰¿æ‹…ç›¸åº”åŽæžœï¼Œæˆ‘ä»¬å°†ä¸æ‰¿æ‹…ä»»ä½•æ³•å¾‹åŠè¿žå¸¦è´£ä»»ã€‚æ‚¨çš„ä¸‹è½½ã€å®‰è£…ã€ä½¿ç”¨ç­‰è¡Œä¸ºå³è§†ä¸ºæ‚¨å·²é˜…è¯»å¹¶åŒæ„ä¸Šè¿°åè®®çš„çº¦æŸ